@namespace BlazyUI
@inherits BlazyInputBase<string>

<select id="@GetFieldId()"
        name="@GetFieldName()"
        class="@ComputedCssClass"
        value="@CurrentValue"
        @onchange="OnChange"
        @attributes="AdditionalAttributes">
    @ChildContent
</select>

@code {
    /// <summary>
    /// The size of the select.
    /// </summary>
    [Parameter]
    public SelectSize Size { get; set; } = SelectSize.Medium;

    /// <summary>
    /// The color of the select.
    /// </summary>
    [Parameter]
    public SelectColor Color { get; set; } = SelectColor.Default;

    /// <summary>
    /// Applies ghost styling (no background).
    /// </summary>
    [Parameter]
    public bool Ghost { get; set; }

    /// <summary>
    /// The options to display in the select. Use &lt;option&gt; elements.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <inheritdoc />
    protected override string GetErrorColorClass() => "select-error";

    /// <inheritdoc />
    protected override bool TryParseValueFromString(
        string? value,
        [System.Diagnostics.CodeAnalysis.NotNullWhen(true)] out string? result,
        [System.Diagnostics.CodeAnalysis.NotNullWhen(false)] out string? validationErrorMessage)
    {
        result = value ?? string.Empty;
        validationErrorMessage = null;
        return true;
    }

    private string ComputedCssClass => MergeClasses(
        "select",
        SizeClass,
        ColorClass,
        Ghost ? "select-ghost" : null
    );

    private void OnChange(ChangeEventArgs e)
        => CurrentValue = e.Value?.ToString();

    private string SizeClass => Size switch
    {
        SelectSize.ExtraSmall => "select-xs",
        SelectSize.Small => "select-sm",
        SelectSize.Medium => "select-md",
        SelectSize.Large => "select-lg",
        SelectSize.ExtraLarge => "select-xl",
        _ => throw new ArgumentOutOfRangeException(nameof(Size), Size, null)
    };

    private string? ColorClass => Color switch
    {
        SelectColor.Default => null,
        SelectColor.Neutral => "select-neutral",
        SelectColor.Primary => "select-primary",
        SelectColor.Secondary => "select-secondary",
        SelectColor.Accent => "select-accent",
        SelectColor.Info => "select-info",
        SelectColor.Success => "select-success",
        SelectColor.Warning => "select-warning",
        SelectColor.Error => "select-error",
        _ => throw new ArgumentOutOfRangeException(nameof(Color), Color, null)
    };
}
