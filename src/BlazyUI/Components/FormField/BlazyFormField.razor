@namespace BlazyUI
@inherits BlazyComponentBase
@typeparam TValue
@using System.Linq.Expressions
@using Microsoft.AspNetCore.Components.Forms

<div class="@ComputedCssClass" @attributes="AdditionalAttributes">
    @if (Orientation == BlazyFormFieldOrientation.Horizontal)
    {
        <div class="flex items-center gap-2">
            @ChildContent
            @if (LabelContent is not null)
            {
                <BlazyLabel TValue="TValue" For="@For" Class="@LabelCssClass">@LabelContent</BlazyLabel>
            }
            else if (!string.IsNullOrEmpty(Label))
            {
                <BlazyLabel TValue="TValue" For="@For" Text="@LabelDisplayText" Class="@LabelCssClass" />
            }
        </div>
        <BlazyFieldValidator TValue="TValue" For="@For" Hint="@Hint" Mode="@ValidationMode" HideHintWhenValid="@HideHintWhenValid" HintClass="@HintClass">
            <HintContent>
                @HintContent
            </HintContent>
        </BlazyFieldValidator>
    }
    else
    {
        @if (LabelContent is not null)
        {
            <BlazyLabel TValue="TValue" For="@For" Class="@LabelCssClass">@LabelContent</BlazyLabel>
        }
        else if (!string.IsNullOrEmpty(Label))
        {
            <BlazyLabel TValue="TValue" For="@For" Text="@LabelDisplayText" Class="@LabelCssClass" />
        }
        <BlazyFieldValidator TValue="TValue" For="@For" Hint="@Hint" Mode="@ValidationMode" HideHintWhenValid="@HideHintWhenValid" HintClass="@HintClass">
            <ChildContent>
                @ChildContent
            </ChildContent>
            <HintContent>
                @HintContent
            </HintContent>
        </BlazyFieldValidator>
    }
    @if (!string.IsNullOrEmpty(HelperText))
    {
        <p class="@HelperTextCssClass">@HelperText</p>
    }
</div>

@code {
    /// <summary>
    /// The label text displayed above the input.
    /// </summary>
    [Parameter]
    public string? Label { get; set; }

    /// <summary>
    /// Custom content for the label. When provided, takes precedence over the Label text parameter.
    /// </summary>
    [Parameter]
    public RenderFragment? LabelContent { get; set; }

    /// <summary>
    /// Expression for the field being validated. Used for both the label's for attribute and ValidationMessage.
    /// </summary>
    [Parameter]
    public Expression<Func<TValue>>? For { get; set; }

    /// <summary>
    /// Additional CSS classes for the label element.
    /// </summary>
    [Parameter]
    public string? LabelClass { get; set; }

    private string? LabelDisplayText => Required ? $"{Label} *" : Label;

    private string LabelCssClass => TwMerge.Merge(
        "font-medium text-base-content text-sm",
        LabelClass
    ) ?? string.Empty;

    /// <summary>
    /// Text hint to display when input is invalid (HTML5 validation).
    /// </summary>
    [Parameter]
    public string? Hint { get; set; }

    /// <summary>
    /// Custom content to display as the validation hint.
    /// </summary>
    [Parameter]
    public RenderFragment? HintContent { get; set; }

    /// <summary>
    /// Determines which validation feedback is shown. Defaults to Both.
    /// </summary>
    [Parameter]
    public BlazyFieldValidatorMode ValidationMode { get; set; } = BlazyFieldValidatorMode.Both;

    /// <summary>
    /// Whether to hide the hint when the input is valid. Defaults to true.
    /// </summary>
    [Parameter]
    public bool HideHintWhenValid { get; set; } = true;

    /// <summary>
    /// Additional CSS classes for the hint element.
    /// </summary>
    [Parameter]
    public string? HintClass { get; set; }

    /// <summary>
    /// Optional helper text displayed below the input (always visible).
    /// </summary>
    [Parameter]
    public string? HelperText { get; set; }

    /// <summary>
    /// Additional CSS classes for the helper text.
    /// </summary>
    [Parameter]
    public string? HelperTextClass { get; set; }

    /// <summary>
    /// The input component to wrap.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Whether this field is required. Adds a visual indicator to the label.
    /// </summary>
    [Parameter]
    public bool Required { get; set; }

    /// <summary>
    /// The layout orientation. Vertical stacks label above input; Horizontal places them side-by-side (useful for checkboxes/toggles).
    /// </summary>
    [Parameter]
    public BlazyFormFieldOrientation Orientation { get; set; } = BlazyFormFieldOrientation.Vertical;

    private string ComputedCssClass => MergeClasses("grid gap-2");

    private string HelperTextCssClass => TwMerge.Merge(
        "text-sm text-base-content/60 mt-1",
        HelperTextClass
    ) ?? string.Empty;
}
