@namespace BlazyUI
@inherits BlazyComponentBase

@if (Variant == LabelVariant.Standalone)
{
    <label class="@ComputedCssClass" for="@For" @attributes="AdditionalAttributes">
        @if (ChildContent is not null)
        {
            @ChildContent
        }
        else
        {
            @Text
        }
    </label>
}
else
{
    <label class="@ComputedCssClass" @attributes="AdditionalAttributes">
        @if (EffectivePosition == LabelPosition.Left)
        {
            @RenderLabelSpan()
            @ChildContent
        }
        else
        {
            @ChildContent
            @RenderLabelSpan()
        }
    </label>
}

@code {
    /// <summary>
    /// The variant determining how the label is rendered.
    /// </summary>
    [Parameter]
    public LabelVariant Variant { get; set; } = LabelVariant.Standalone;

    /// <summary>
    /// The position of the label text relative to wrapped content.
    /// Only applies when Variant is Input or Select. Throws if used with other variants.
    /// </summary>
    [Parameter]
    public LabelPosition? Position { get; set; }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        if (Position.HasValue && Variant is not (LabelVariant.Input or LabelVariant.Select))
        {
            throw new InvalidOperationException(
                $"Position can only be used with {nameof(LabelVariant.Input)} or {nameof(LabelVariant.Select)} variants. " +
                $"Current variant: {Variant}");
        }
    }

    private LabelPosition EffectivePosition => Position ?? LabelPosition.Left;

    /// <summary>
    /// The id of the input element this label is for.
    /// Only used when Variant is Standalone.
    /// </summary>
    [Parameter]
    public string? For { get; set; }

    /// <summary>
    /// The label text. Used when ChildContent is not provided (Standalone)
    /// or as the label span text (Input/Select/Floating variants).
    /// </summary>
    [Parameter]
    public string? Text { get; set; }

    /// <summary>
    /// Custom content for the label.
    /// For Standalone: replaces Text as the label content.
    /// For Input/Select/Floating: the wrapped input/select element.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private string ComputedCssClass => Variant switch
    {
        LabelVariant.Standalone => MergeClasses("label"),
        LabelVariant.Input => MergeClasses("input"),
        LabelVariant.Select => MergeClasses("select"),
        LabelVariant.Floating => MergeClasses("floating-label"),
        _ => throw new ArgumentOutOfRangeException(nameof(Variant), Variant, null)
    };

    private RenderFragment RenderLabelSpan() => __builder =>
    {
        <span class="label">@Text</span>
    };
}
